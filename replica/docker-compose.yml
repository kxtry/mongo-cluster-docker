version: '3'
services:
    mgoprimary:
        container_name: "mgoprimary"
        image: mongo:4.2
        ports:
            - "30012:27017"
        command: mongod --replSet vmlocal --port 27017  --oplogSize 16 --noprealloc --smallfiles
        links:
            - mgoreplica1:mgoreplica1
            - mgoreplica2:mgoreplica2
        restart: always

    mgoreplica1:
        container_name: "mgoreplica1"
        image: mongo:4.2
        ports:
            - "30013:27017"
        command: mongod --replSet vmlocal --port 27017  --oplogSize 16 --noprealloc --smallfiles
        restart: always 

    mgoreplica2:
        container_name: "mgoreplica2"
        image: mongo:4.2
        ports:
            - "30011:27017"
        command: mongod --replSet vmlocal --port 27017  --oplogSize 16 --noprealloc --smallfiles        
        restart: always

    setup-vmlocal:
        container_name: "setup-vmlocal"
        image: mongo:4.2
        depends_on:
            - "mgoprimary"
            - "mgoreplica1"
            - "mgoreplica2"
        links:
            - mgoprimary:mgoprimary
            - mgoreplica1:mgoreplica1
            - mgoreplica2:mgoreplica2
        volumes:
            - ./scripts:/scripts
        environment: 
            - MONGO1=mgoprimary
            - MONGO2=mgoreplica1
            - MONGO3=mgoreplica2
            - RS=vmlocal
        entrypoint: [ "/scripts/setup.sh" ]

        
